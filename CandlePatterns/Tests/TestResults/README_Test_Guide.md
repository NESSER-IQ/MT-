# دليل استخدام ملف اختبار أنماط الشموع المفردة

## نظرة عامة
هذا الملف (TestSingleCandlePatterns.mq5) هو برنامج اختبار شامل لمكتبة أنماط الشموع اليابانية المفردة. يقوم بإجراء سلسلة من الاختبارات المنهجية للتأكد من سلامة وفعالية المكتبة.

## الميزات الرئيسية

### 1. اختبارات شاملة
- **اختبار البنية الأساسية**: فحص صحة تهيئة المكتبة وتحميل الأنماط
- **اختبار مرافق الشموع**: فحص دوال حساب خصائص الشموع
- **اختبار الأنماط الفردية**: فحص كل نمط على حدة
- **اختبار التكامل**: فحص عمل النظام كاملاً مع بيانات حقيقية
- **اختبار الأداء**: قياس سرعة ودقة الكشف
- **اختبارات الضغط**: فحص التعامل مع الحالات الاستثنائية

### 2. أنماط الشموع المختبرة
- **أنماط الدوجي**: الدوجي العادي، طويل الأرجل، شاهد القبر، اليعسوب
- **أنماط المطرقة**: المطرقة، المطرقة المقلوبة، نجم الشهاب، الرجل المشنوق
- **أنماط الماروبوزو**: الصاعد والهابط
- **أنماط حزام الحمل**: الصاعد والهابط

### 3. إعدادات قابلة للتخصيص
```cpp
input bool InpEnableDojiTests = true;        // تمكين اختبارات الدوجي
input bool InpEnableHammerTests = true;      // تمكين اختبارات المطرقة
input bool InpEnableMarubozuTests = true;    // تمكين اختبارات الماروبوزو
input bool InpEnableBeltHoldTests = true;    // تمكين اختبارات حزام الحمل
input bool InpEnableStressTests = true;      // تمكين اختبارات الضغط
input bool InpVerboseOutput = true;          // إخراج مفصل
input int InpTestDataSize = 100;             // حجم بيانات الاختبار
input double InpSensitivityLevel = 1.0;     // مستوى الحساسية
```

## كيفية الاستخدام

### 1. الإعداد
1. تأكد من وجود جميع ملفات المكتبة في المسارات الصحيحة
2. ضع ملف الاختبار في مجلد `Tests/TestResults`
3. افتح MetaTrader 5 وكومپايل الملف

### 2. تشغيل الاختبار
1. أضف المؤشر إلى أي مخطط
2. اضبط المعاملات حسب احتياجاتك
3. سيتم تشغيل جميع الاختبارات تلقائياً عند التهيئة

### 3. قراءة النتائج
- **في نافذة الخبراء**: عرض مباشر لسير الاختبارات
- **تقرير مفصل**: ملف نصي يحفظ تلقائياً مع النتائج الكاملة
- **إحصائيات**: معدل النجاح والفشل وتفاصيل الأداء

## هيكل الاختبارات

### اختبار البنية الأساسية
```cpp
void TestBasicInfrastructure()
{
    // فحص إنشاء مدير الأنماط
    // فحص تحميل الفئات المختلفة
    // فحص عدد الأنماط في كل فئة
}
```

### اختبار مرافق الشموع
```cpp
void TestCandleUtils()
{
    // فحص حساب جسم الشمعة
    // فحص حساب الظلال
    // فحص تحديد نوع الشمعة
    // فحص كشف الدوجي
}
```

### اختبار الأنماط الفردية
```cpp
void TestDojiPatterns()
{
    // اختبار الدوجي العادي
    // اختبار دوجي طويل الأرجل
    // اختبار دوجي شاهد القبر
    // اختبار دوجي اليعسوب
}
```

## أمثلة على بيانات الاختبار

### دوجي مثالي
```cpp
void CreateDojiTestData(...)
{
    open[0] = 1.1000;
    close[0] = 1.1001; // فرق صغير جداً
    high[0] = 1.1020;
    low[0] = 1.0980;
    volume[0] = 1000;
}
```

### مطرقة نموذجية
```cpp
void CreateHammerTestData(...)
{
    open[0] = 1.1010;
    close[0] = 1.1015; // إغلاق أعلى من الافتتاح
    high[0] = 1.1020;  // ظل علوي قصير
    low[0] = 1.0980;   // ظل سفلي طويل
    volume[0] = 2000;
}
```

## قراءة التقرير

### ملخص الاختبارات
```
=== ملخص الاختبارات ===
إجمالي الاختبارات: 25
نجح: 24
فشل: 1
معدل النجاح: 96.0%
```

### تفاصيل الأداء
```
=== اختبار الأداء ===
وقت المعالجة الإجمالي: 245 مللي ثانية
متوسط الوقت لكل شمعة: 2.45 مللي ثانية
إجمالي الكشوفات: 38
```

### إحصائيات الكشف
```
=== اختبار التكامل ===
معدل الكشف: 15.2%
إجمالي الأنماط المكتشفة: 38
الشموع المفحوصة: 250
```

## استكشاف الأخطاء

### أخطاء شائعة
1. **فشل في التهيئة**: تأكد من وجود جميع الملفات المطلوبة
2. **بيانات غير صحيحة**: تحقق من صحة بيانات السوق
3. **أخطاء في الذاكرة**: تأكد من كفاية الذاكرة المتاحة

### رسائل الخطأ
- `"خطأ: فشل في إنشاء مدير الأنماط"`: مشكلة في الذاكرة
- `"خطأ: فشل في تهيئة مدير الأنماط"`: مشكلة في الملفات المطلوبة
- `"فشل في حفظ تقرير الاختبار"`: مشكلة في صلاحيات الكتابة

## تطوير اختبارات إضافية

### إضافة اختبار جديد
```cpp
void TestNewPattern()
{
    Print("اختبار النمط الجديد...");
    g_testResults += "=== اختبار النمط الجديد ===\n";
    
    // إنشاء بيانات الاختبار
    double open[], high[], low[], close[];
    long volume[];
    CreateNewPatternTestData(open, high, low, close, volume);
    
    // إنشاء كائن النمط
    CNewPattern* pattern = new CNewPattern();
    if(pattern != NULL)
    {
        bool detected = pattern.Detect(0, open, high, low, close, volume);
        AssertTrue(detected, "كشف النمط الجديد");
        delete pattern;
    }
    
    g_testResults += "\n";
}
```

### إضافة دالة تحقق مخصصة
```cpp
void AssertEquals(double expected, double actual, string testName)
{
    g_totalTests++;
    
    if(MathAbs(expected - actual) < 0.00001)
    {
        g_passedTests++;
        if(InpVerboseOutput)
            Print("✓ نجح: ", testName);
        g_testResults += "✓ " + testName + ": نجح\n";
    }
    else
    {
        g_failedTests++;
        Print("✗ فشل: ", testName, " - توقع: ", expected, " حصل: ", actual);
        g_testResults += "✗ " + testName + ": فشل\n";
    }
}
```

## الخلاصة
هذا الملف يوفر اختباراً شاملاً لمكتبة أنماط الشموع اليابانية، مما يضمن:
- صحة عمل جميع المكونات
- دقة كشف الأنماط
- كفاءة الأداء
- قوة التعامل مع الحالات الاستثنائية

يمكن استخدامه كنموذج لتطوير اختبارات إضافية للمكونات الأخرى في المكتبة.
